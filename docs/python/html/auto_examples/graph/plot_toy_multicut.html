
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Multicut Logging Visitor &#8212; Nifty 0.7.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.7.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Cgp Cartesian Grid Partitioning 2D" href="plot_cgp_introduction.html" />
    <link rel="prev" title="Agglomerative Clustering" href="plot_agglomerative_clustering.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="plot_cgp_introduction.html" title="Cgp Cartesian Grid Partitioning 2D"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_agglomerative_clustering.html" title="Agglomerative Clustering"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Nifty 0.7.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Gallery of Examples</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="plot_agglomerative_clustering.html"
                        title="previous chapter">Agglomerative Clustering</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plot_cgp_introduction.html"
                        title="next chapter">Cgp Cartesian Grid Partitioning 2D</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="multicut-logging-visitor">
<span id="sphx-glr-auto-examples-graph-plot-toy-multicut-py"></span><h1>Multicut Logging Visitor<a class="headerlink" href="#multicut-logging-visitor" title="Permalink to this headline">Â¶</a></h1>
<p>Compare multicut solvers on a graph
with a random topology and random edge weights.</p>
<p>This example is NOT about the actual energies
and runtimes since these random graphs with
random weights are not very insightful.
Furthermore the problem is to small
to let CPLEX shine in comparison to GLPK.
Here we want to show how to run solvers
and log the runtime / energies.</p>
<img alt="../../_images/sphx_glr_plot_toy_multicut_001.png" class="align-center" src="../../_images/sphx_glr_plot_toy_multicut_001.png" />
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="c1"># numpy</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1"># Plotting</span>
<span class="kn">import</span> <span class="nn">pylab</span>

<span class="c1"># nifty</span>
<span class="kn">import</span> <span class="nn">nifty</span>
<span class="kn">import</span> <span class="nn">nifty.graph.optimization.multicut</span>  <span class="kn">as</span> <span class="nn">nifty_multicut</span>


<span class="c1"># a toy graph with random</span>
<span class="c1"># topology</span>
<span class="n">numberOfNodes</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">approxNumberOfEdges</span> <span class="o">=</span> <span class="mi">200</span>

<span class="c1"># random edges</span>
<span class="n">uvIds</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.random.randint.html#numpy.random.randint" title="View documentation for numpy.random.randint"><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span></a><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">numberOfNodes</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">approxNumberOfEdges</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">uvIds</span> <span class="o">=</span> <span class="n">uvIds</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">uvIds</span> <span class="o">=</span> <span class="n">uvIds</span><span class="p">[</span><span class="n">uvIds</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="n">uvIds</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],:]</span>

<span class="c1"># setup graph</span>
<span class="n">Graph</span> <span class="o">=</span> <a href="../../gen_modules/nifty.graph.html#nifty.graph.UndirectedGraph" title="View documentation for nifty.graph.UndirectedGraph"><span class="n">nifty</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">UndirectedGraph</span></a>
<span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">numberOfNodes</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">insertEdges</span><span class="p">(</span><span class="n">uvIds</span><span class="p">)</span>

<span class="c1"># random edge weights</span>
<span class="n">weights</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.random.rand.html#numpy.random.rand" title="View documentation for numpy.random.rand"><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span></a><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">numberOfEdges</span><span class="p">)</span> <span class="o">-</span><span class="mf">0.5</span>


<span class="c1"># construct a multicut objective</span>
<span class="n">MulticutObjective</span> <span class="o">=</span> <span class="n">Graph</span><span class="o">.</span><span class="n">MulticutObjective</span>
<span class="n">objective</span> <span class="o">=</span> <span class="n">MulticutObjective</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">runSolver</span><span class="p">(</span><span class="n">solverFactory</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; run solver and return energies and runtimes&quot;&quot;&quot;</span>
    <span class="n">loggingVisitor</span> <span class="o">=</span> <span class="n">MulticutObjective</span><span class="o">.</span><span class="n">loggingVisitor</span><span class="p">(</span><span class="n">visitNth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">solverFactory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">loggingVisitor</span><span class="p">)</span>
    <span class="n">energies</span> <span class="o">=</span> <span class="n">loggingVisitor</span><span class="o">.</span><span class="n">energies</span><span class="p">()</span>
    <span class="n">runtimes</span> <span class="o">=</span> <span class="n">loggingVisitor</span><span class="o">.</span><span class="n">runtimes</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">energies</span><span class="p">,</span><span class="n">runtimes</span>


<span class="c1"># store results for each solver</span>
<span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="c1"># greedy-additive</span>
<span class="n">solverFactory</span> <span class="o">=</span> <span class="n">MulticutObjective</span><span class="o">.</span><span class="n">greedyAdditiveFactory</span><span class="p">()</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;greedy-additive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runSolver</span><span class="p">(</span><span class="n">solverFactory</span><span class="p">)</span>

<span class="k">if</span> <span class="n">nifty</span><span class="o">.</span><span class="n">Configuration</span><span class="o">.</span><span class="n">WITH_QPBO</span><span class="p">:</span>

    <span class="c1"># cgc</span>
    <span class="n">solverFactory</span> <span class="o">=</span> <span class="n">MulticutObjective</span><span class="o">.</span><span class="n">cgcFactory</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;cgc-qpbo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runSolver</span><span class="p">(</span><span class="n">solverFactory</span><span class="p">)</span>

    <span class="c1"># greedy-additive + cgc</span>
    <span class="n">solverFactory</span> <span class="o">=</span> <span class="n">MulticutObjective</span><span class="o">.</span><span class="n">chainedSolversFactory</span><span class="p">([</span>
        <span class="n">MulticutObjective</span><span class="o">.</span><span class="n">greedyAdditiveFactory</span><span class="p">(),</span>
        <span class="n">MulticutObjective</span><span class="o">.</span><span class="n">cgcFactory</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;greedy-additive + cgc-qpbo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runSolver</span><span class="p">(</span><span class="n">solverFactory</span><span class="p">)</span>


<span class="k">if</span> <span class="n">nifty</span><span class="o">.</span><span class="n">Configuration</span><span class="o">.</span><span class="n">WITH_CPLEX</span><span class="p">:</span>
    <span class="n">solverFactory</span> <span class="o">=</span> <span class="n">MulticutObjective</span><span class="o">.</span><span class="n">multicutIlpCplexFactory</span><span class="p">()</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ilp-cplex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runSolver</span><span class="p">(</span><span class="n">solverFactory</span><span class="p">)</span>

<span class="k">if</span> <span class="n">nifty</span><span class="o">.</span><span class="n">Configuration</span><span class="o">.</span><span class="n">WITH_GUROBI</span><span class="p">:</span>
    <span class="n">solverFactory</span> <span class="o">=</span> <span class="n">MulticutObjective</span><span class="o">.</span><span class="n">multicutIlpGurobiFactory</span><span class="p">()</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ilp-gurbi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runSolver</span><span class="p">(</span><span class="n">solverFactory</span><span class="p">)</span>

<span class="k">if</span> <span class="n">nifty</span><span class="o">.</span><span class="n">Configuration</span><span class="o">.</span><span class="n">WITH_GLPK</span><span class="p">:</span>
    <span class="n">solverFactory</span> <span class="o">=</span> <span class="n">MulticutObjective</span><span class="o">.</span><span class="n">multicutIlpGlpkFactory</span><span class="p">()</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ilp-glpk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runSolver</span><span class="p">(</span><span class="n">solverFactory</span><span class="p">)</span>

<span class="c1"># plot the results</span>

<span class="c1"># increase default figure size</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">b</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="p">(</span><span class="n">runtimes</span><span class="p">,</span><span class="n">energies</span><span class="p">)</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">pylab</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">energies</span><span class="p">,</span> <span class="n">runtimes</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">pylab</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Multicut Solver Comparison on Toy Graph&#39;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Runtime [s]&#39;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Total running time of the script:</strong> ( 0 minutes  0.089 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_toy_multicut.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_toy_multicut.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_toy_multicut.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_toy_multicut.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Generated by Sphinx-Gallery</a></p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="plot_cgp_introduction.html" title="Cgp Cartesian Grid Partitioning 2D"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_agglomerative_clustering.html" title="Agglomerative Clustering"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Nifty 0.7.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Gallery of Examples</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.1.
    </div>
  </body>
</html>