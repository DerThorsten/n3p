

.. _sphx_glr_auto_examples_graph_plot_undirected_grid_graph_watershed.py:


Edge/Node Weighted Watersheds
====================================

Compare edge weighted watersheds
and node weighted on a grid graph.





.. code-block:: python

    # sphinx_gallery_thumbnail_number = 4







load modules
and do some minor setup



.. code-block:: python

    from __future__ import print_function

    import nifty.graph
    import skimage.data 
    import skimage.segmentation 
    import vigra
    import matplotlib
    import pylab
    import numpy

    # increase default figure size
    a,b = pylab.rcParams['figure.figsize']
    pylab.rcParams['figure.figsize'] = 2.0*a, 2.0*b








load some image



.. code-block:: python

    img = skimage.data.astronaut().astype('float32')
    shape = img.shape[0:2]

    #plot the image
    pylab.imshow(img/255)
    pylab.show()




.. image:: /auto_examples/graph/images/sphx_glr_plot_undirected_grid_graph_watershed_001.png
    :align: center




get some edge indicator



.. code-block:: python

    taggedImg = vigra.taggedView(img,'xyc')
    edgeStrength = vigra.filters.structureTensorEigenvalues(taggedImg, 1.5, 1.9)[:,:,0]
    edgeStrength = edgeStrength.squeeze()
    edgeStrength = numpy.array(edgeStrength)
    pylab.imshow(edgeStrength)
    pylab.show()




.. image:: /auto_examples/graph/images/sphx_glr_plot_undirected_grid_graph_watershed_002.png
    :align: center




get seeds via local minima



.. code-block:: python

    seeds = vigra.analysis.localMinima(edgeStrength)
    seeds = vigra.analysis.labelImageWithBackground(seeds)

    # plot seeds
    cmap =  numpy.random.rand ( seeds.max()+1,3)
    cmap[0,:] = 0
    cmap = matplotlib.colors.ListedColormap ( cmap)
    pylab.imshow(seeds, cmap=cmap)
    pylab.show()






.. image:: /auto_examples/graph/images/sphx_glr_plot_undirected_grid_graph_watershed_003.png
    :align: center




grid graph



.. code-block:: python

    gridGraph = nifty.graph.undirectedGridGraph(shape)










convert image to grid graph edge map



.. code-block:: python

    gridGraphEdgeStrength = gridGraph.imageToEdgeMap(edgeStrength, mode='sum')
    numpy.random.permutation(gridGraphEdgeStrength)









run edge weighted watershed algorithm



.. code-block:: python

    oversegEdgeWeighted = nifty.graph.edgeWeightedWatershedsSegmentation(graph=gridGraph, seeds=seeds.ravel(),
        edgeWeights=gridGraphEdgeStrength)
    oversegEdgeWeighted = oversegEdgeWeighted.reshape(shape)









run node weighted watershed algorithm



.. code-block:: python

    oversegNodeWeighted = nifty.graph.nodeWeightedWatershedsSegmentation(graph=gridGraph, seeds=seeds.ravel(),
        nodeWeights=edgeStrength.ravel())
    oversegNodeWeighted = oversegNodeWeighted.reshape(shape)









plot results



.. code-block:: python

    f = pylab.figure()
    f.add_subplot(1, 2, 1)
    b_img = skimage.segmentation.mark_boundaries(img/255, 
            oversegEdgeWeighted.astype('uint32'), mode='inner', color=(0.1,0.1,0.2))
    pylab.imshow(b_img)
    pylab.title('Edge Weighted Watershed')

    f.add_subplot(1, 2, 2)
    b_img = skimage.segmentation.mark_boundaries(img/255, 
            oversegNodeWeighted.astype('uint32'), mode='inner', color=(0.1,0.1,0.2))
    pylab.imshow(b_img)
    pylab.title('Node Weighted Watershed')


    pylab.show()


.. image:: /auto_examples/graph/images/sphx_glr_plot_undirected_grid_graph_watershed_004.png
    :align: center




**Total running time of the script:** ( 0 minutes  0.827 seconds)



.. container:: sphx-glr-footer


  .. container:: sphx-glr-download

     :download:`Download Python source code: plot_undirected_grid_graph_watershed.py <plot_undirected_grid_graph_watershed.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: plot_undirected_grid_graph_watershed.ipynb <plot_undirected_grid_graph_watershed.ipynb>`

.. rst-class:: sphx-glr-signature

    `Generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
